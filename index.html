<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RentelBike - Final App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* --- General Styles (Same as before) --- */
body{margin:0;font-family:Arial, sans-serif;background:#f2f2f2; overflow-x: hidden;} 
header{
  background:#0f172a;
  color:#fff;
  padding:14px;
  text-align:center;
  font-weight:bold;
  position: fixed; 
  top: 0; 
  width: 100%; 
  height: 40px; 
  box-sizing: border-box;
  z-index: 100;
  transition: opacity 0.3s ease; 
}
.page{
  display:none;
  padding:15px;
  padding-bottom: 90px;
  min-height: calc(100vh - 40px);
  box-sizing: border-box; 
  margin-top: 40px; 
  left: 0;
  width: 100%;
  background: #f2f2f2; 
  position: relative; 
  z-index: 1; 
}
.page.active{display:block}
.card{background:#fff;border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
input,select,textarea{width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;margin-top:8px;box-sizing:border-box}
button{width:100%;padding:12px;border:none;border-radius:6px;margin-top:10px;font-weight:bold; cursor: pointer; z-index: 2;}
.green{background:#22c55e;color:#fff}
.red{background:#ef4444;color:#fff}
.orange{background:#f97316;color:#fff}
.gray{background:#64748b;color:#fff}
.blue{background:#3b82f6;color:#fff} 

/* --- New Label Style for DOB --- */
label.form-label {
    display: block; 
    margin-top: 10px; 
    margin-bottom: 5px; 
    font-size: 14px;
    color: #333;
    font-weight: bold;
}

/* --- Navigation Styles (Same as before) --- */
nav{
  position:fixed;
  bottom:0;
  width:100%;
  display: flex; 
  background:#fff;
  border-top:1px solid #ccc;
  z-index: 50; 
  height: 50px; 
  transition: opacity 0.3s ease;
}
nav button{flex:1;background:#fff;border:none;padding:10px;font-size:14px}
.profile-item-btn {
    width: 100%;
    text-align: left;
    background: #fff;
    border: none;
    border-radius: 0;
    padding: 14px 0;
    margin: 0;
    border-bottom: 1px solid #eee;
    font-weight: normal;
    cursor: pointer;
    box-sizing: border-box;
    display: block; 
}
.profile-item-btn:last-child {
    border-bottom: none;
}
small{font-size:11px;color:#6b7280}
.text-center{text-align:center;}
.img-slider{display:flex;gap:8px;overflow-x:auto;margin-bottom:10px; padding: 5px 0;}
.img-slider img{
  width:90%; 
  min-width: 90%; 
  height: 150px;
  object-fit:cover;
  border-radius:10px;
  cursor: zoom-in; 
}

/* Owner Card Styles for About Us */
.owner-card {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 10px;
    margin-bottom: 10px;
    border-bottom: 1px solid #eee;
}
.owner-card img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #22c55e;
}
/* Auth Page Fixes */
body.auth-page header, 
body.auth-page nav {
    display: none !important; 
    opacity: 0;
}
#login, #signupForm, #forgotPass, #verifyResetOTP {
    padding-bottom: 15px; 
    margin-top: 0;
    padding-top: 50px; 
    min-height: 100vh; 
}

/* Other Page Styles */
#home {
    background: linear-gradient(to right, #f97316, #22c55e); 
    padding-top: 15px; 
    margin-top: 40px; 
}
#home .card {
    background: rgba(255, 255, 255, 0.9); 
}
/* About Us Gradient */
#aboutUs .card {
    background: linear-gradient(to right, #f973161a, #22c55e1a); /* Light transparent gradient */
    border: 1px solid #ccc;
}

/* NEW: Listed Bike Card */
.listed-bike-item {
    padding: 15px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
}
.address-item {
    border-bottom: 1px dashed #ccc; 
    padding: 10px 0; 
    display: flex; 
    justify-content: space-between;
    align-items: center;
}
.address-item:last-child {
    border-bottom: none;
}
.address-item button {
    width: auto; 
    padding: 5px 10px;
    margin: 0;
    font-size: 12px;
}
</style>
</head>

<body onload="loadAll()">

<header id="appHeader">RentelBike</header>

<div id="login" class="page auth-page active">
  <div class="card">
    <h2>Login</h2>
    <input type="text" id="mobileInput" placeholder="Mobile">
    <input type="password" id="passwordInput" placeholder="Password / OTP">
    <button class="green" onclick="login()">Login</button>
    <button class="blue" onclick="showPage('forgotPass')">Forgot Password? (Use OTP)</button>
    <button class="gray" onclick="showPage('signupForm')">New User? Sign Up</button>
    <button class="gray" onclick="loginAsGuest()">Skip for now</button>
  </div>
</div>
<div id="signupForm" class="page auth-page">
  <div class="card">
    <h2>Create Account</h2>
    <input type="text" id="signup_name" placeholder="Full Name *">
    <input type="email" id="signup_email" placeholder="Email (Optional)">
    <label for="signup_dob" class="form-label">Date of Birth *</label>
    <input type="date" id="signup_dob" >
    <input type="text" id="signup_referral" placeholder="Referral Code (Optional)">
    <input type="tel" id="signup_mobile" placeholder="Mobile *">
    <input type="password" id="signup_password" placeholder="Set Password *">
    <button class="green" onclick="signup()">Sign Up & Complete</button>
    <button class="gray" onclick="showPage('login')">‚Üê Back to Login</button>
  </div>
</div>
<div id="forgotPass" class="page auth-page">
  <div class="card">
    <h2>Forgot Password / Send OTP</h2>
    <input type="tel" id="forgot_mobile" placeholder="Registered Mobile *">
    <button class="green" onclick="sendOTP()">Send OTP</button>
    <button class="gray" onclick="showPage('login')">‚Üê Back to Login</button>
  </div>
</div>
<div id="verifyResetOTP" class="page auth-page">
  <div class="card">
    <h2>Verify & Reset</h2>
    <p>Simulated OTP sent to <span id="otpTimer">60s</span></p>
    <input type="text" id="otp_input" placeholder="Enter Simulated OTP (123456) *">
    <input type="password" id="reset_newPass" placeholder="Set New Password *">
    <button class="green" onclick="resetPassword()">Reset Password</button>
    <button class="gray" onclick="showPage('login')">‚Üê Back</button>
  </div>
</div>

<div id="home" class="page">
  <div class="card text-center">
    <h1>RentelBike</h1>
    <p>Bike Rental Platform</p>
    <hr>
    <h3>Dashboard</h3>
    <button class="green" onclick="showPage('explore')">Explore Bikes</button>
    <button class="blue" onclick="showPage('listBikeForm')">List a Bike</button>
    <button class="orange" onclick="adminLogin('admin')">Admin Bike Panel</button>
    <button class="orange" onclick="adminLogin('kyc')">Admin KYC Panel</button>
  </div>

  <div class="card">
    <h4>My Listed Bikes (Dashboard View)</h4>
    <p>Royal Enfield Classic 350 <span style="color:green;font-weight:bold;">Approved</span></p>
    <button class="blue" onclick="showPage('myListedBikesPage')">View/Manage All Listed Bikes</button>
  </div>
</div>

<div id="explore" class="page">
  <div class="card">
    <h3>Explore Bikes</h3>
    <input type="text" placeholder="Search by City, Model, or State">
    <button class="green" onclick="searchBikes()">Search</button>
  </div>
  
  <div class="card">
    <h4>Bikes Near You (Simulated)</h4>
    <p>Hero Splendor (Pratapgarh) <small>‚Çπ300/day</small></p>
    <div class="img-slider">
      <img src="https://i.ibb.co/L5k1g0F/1000055678.jpg" alt="Bike 1">
    </div>
    <button class="blue" onclick="showBikeDetail('Hero Splendor', 300, 'Hero Splendor Images')">View Details</button>
    
    <p style="margin-top: 15px;">Royal Enfield Classic 350 (New Delhi) <small>‚Çπ700/day</small></p>
    <div class="img-slider">
      <img src="https://i.ibb.co/3sX0jB8/1000055679.jpg" alt="Bike 2">
    </div>
    <button class="blue" onclick="showBikeDetail('Royal Enfield Classic 350', 700, 'Royal Enfield Classic 350 Images')">View Details</button>
  </div>
</div>

<div id="bikeDetail" class="page">
  <div class="card">
    <h3 id="bike_model">Bike Model</h3>
    <div class="img-slider" id="bike_images">
      </div>
    <p>Rate: <span id="bike_rate"></span></p>
    <p>Location: New Delhi, India</p>
    <p>Insurance Expiry: 25/01/2026</p>
    <p>Owner: Renter User 1</p> 

    <label for="rent_days">Number of Days:</label>
    <input type="number" id="rent_days" value="1" min="1" onchange="calculateTotal()">
    <p>Total Amount: **<span id="bike_total_amount">‚Çπ0</span>**</p>
    <button class="green" onclick="bookBike()">Book Now</button>
    <button class="gray" onclick="back()">‚Üê Back</button>
  </div>
</div>

<div id="payment" class="page">
  <div class="card">
    <h3>Payment Simulation</h3>
    <p>You are renting <span id="payment_bike_model"></span> for <span id="payment_rent_days"></span> days.</p>
    <p>Total Amount: **‚Çπ<span id="payment_total_amount">0</span>**</p>

    <label for="payment_method">Payment Method (Simulated)</label>
    <select id="payment_method">
      <option value="Card">Card (Simulated)</option>
      <option value="UPI">UPI (Simulated)</option>
    </select>
    <input type="text" id="payment_details" placeholder="Enter UPI ID / Card Details (Simulated)">
    <button class="green" onclick="confirmPayment()">Confirm Payment (Simulate)</button>
    <button class="gray" onclick="back()">‚Üê Cancel</button>
  </div>
</div>


<div id="profile" class="page">
  <div class="card">
    <h3>Owner Details (Your Profile)</h3>
    <p>Name: <span id="profile_name">User Name</span></p>
    <p>Mobile: <span id="profile_mobile"></span></p>
    <p>Email: <span id="profile_email">N/A</span></p>
    <p>DOB: <span id="profile_dob">N/A</span></p>
  </div>
  
  <div class="card">
    <h3>KYC Status</h3>
    <p>Status: **<span id="kyc_status" style="color:red;">PENDING</span>**</p>
    <button id="kyc_button" class="orange" onclick="showPage('kycUpload')">Upload KYC Documents</button>
  </div>

  <div class="card">
    <h3>My Activity & Details</h3>
    <button class="profile-item-btn" onclick="showPage('myListedBikesPage')">Your Listed Bikes</button>
    <button class="profile-item-btn" onclick="showPage('transactionHistory')">Transaction History</button>
    <button class="profile-item-btn" onclick="showPage('invoicesAndBills')">Invoices & Bills</button> 
    <button class="profile-item-btn" onclick="showPage('savedAddressesPage')">Saved Addresses</button>
    <button class="profile-item-btn" onclick="showPage('walletEarnings')">Wallet & Earnings</button>
  </div>

  <div class="card">
    <h3>Company</h3>
    <button class="profile-item-btn" onclick="showPage('aboutUs')">About Us (Company Info)</button>
    <button class="profile-item-btn" onclick="showPage('contactSupportPage')">Contact Support</button>
  </div>

  <div class="card">
    <h3>Your Bookings</h3>
    <p>No bookings yet.</p>
  </div>
  
  <button class="red" onclick="logout()">Logout</button>
</div>
<div id="invoicesAndBills" class="page">
    <div class="card">
        <h3>üìÑ Invoices & Bills</h3>
        <p>Your recent invoices are listed below. Click to download as PDF.</p>
        <hr>
        
        <div style="padding: 10px 0; border-bottom: 1px dashed #ccc;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>Invoice #RB-2025-03-001</strong><br>
                    <small>Amount: ‚Çπ900 | Date: 12/03/2025</small>
                </div>
                <button class="blue" style="width: 100px; margin: 0; padding: 5px;" onclick="downloadPDF('RB-2025-03-001')">
                    Download PDF
                </button>
            </div>
        </div>

        <div style="padding: 10px 0;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>Bill #RB-2025-03-002 (Earning)</strong><br>
                    <small>Amount: ‚Çπ2,100 | Date: 05/03/2025</small>
                </div>
                <button class="blue" style="width: 100px; margin: 0; padding: 5px;" onclick="downloadPDF('RB-2025-03-002')">
                    Download PDF
                </button>
            </div>
        </div>

    </div>
    <button class="gray" onclick="back()">‚Üê Back to Profile</button>
</div>

<div id="myListedBikesPage" class="page">
    <div class="card">
        <h3>üèçÔ∏è Your Listed Bikes</h3>
        <p>Manage your bikes listed for rent. You can edit details or change availability.</p>
        <hr>
        
        <div class="listed-bike-item">
            <strong>Royal Enfield Classic 350</strong><br>
            <small>Location: New Delhi | Rate: ‚Çπ700/day</small><br>
            <small style="color:green;font-weight:bold;">Status: Approved & Active</small>
            <button class="orange" onclick="alert('Redirecting to Edit Bike form (Simulated)')">Edit Details</button>
            <button class="red" onclick="alert('Bike status changed to Inactive (Simulated)')">Deactivate Listing</button>
        </div>

        <div class="listed-bike-item">
            <strong>Hero Splendor Pro</strong><br>
            <small>Location: Lucknow | Rate: ‚Çπ350/day</small><br>
            <small style="color:red;font-weight:bold;">Status: Pending Admin Review</small>
            <button class="gray" onclick="alert('Cannot edit while under review.')">View Details</button>
        </div>

        <button class="green" onclick="showPage('listBikeForm')"> + List a New Bike</button>
    </div>
    <button class="gray" onclick="back()">‚Üê Back to Profile</button>
</div>

<div id="contactSupportPage" class="page">
    <div class="card">
        <h3>üìû Contact Support</h3>
        <p>Our team is ready to assist you with any questions or issues.</p>
        <hr>
        <p><strong>Email Us:</strong> <a href="mailto:rbadmin@gmail.com">rbadmin@gmail.com</a></p>
        <p><strong>Call Us:</strong> <a href="tel:0987654321">0987654321</a></p>
    </div>
    <div class="card">
        <h4>Send Us a Message</h4>
        <input type="text" placeholder="Your Name">
        <input type="email" placeholder="Your Email">
        <textarea placeholder="Your Message or Query"></textarea>
        <button class="blue" onclick="submitSupportMessage()">Submit Message</button>
    </div>
    <button class="gray" onclick="back()">‚Üê Back to Profile</button>
</div>

<div id="savedAddressesPage" class="page">
    <div class="card">
        <h3>üìç Saved Addresses</h3>
        <p>Manage your pickup and drop-off locations.</p>
        <hr>
        <div id="addressList">
             <div class="address-item">
                <div>
                    <strong>Home:</strong> 101, Near Old Market, New Delhi, India 
                </div>
                <button class="red" onclick="deleteAddress(this)">Delete</button>
            </div>
            <div class="address-item">
                <div>
                    <strong>Office:</strong> Tech Park, Tower A, Gurugram, India 
                </div>
                <button class="red" onclick="deleteAddress(this)">Delete</button>
            </div>
        </div>
        <hr>
        <button class="green" onclick="showPage('addAddressForm')"> + Add New Address</button>
    </div>
    <button class="gray" onclick="back()">‚Üê Back to Profile</button>
</div>

<div id="addAddressForm" class="page">
    <div class="card">
        <h3>Add New Address</h3>
        <label for="address_type">Address Type *</label>
        <select id="address_type">
            <option value="Other" selected>Other</option>
            <option value="Home">Home</option>
            <option value="Office">Office</option>
        </select>
        <textarea id="full_address" placeholder="Full Address (House No., Street, Landmark) *"></textarea>
        <input type="text" id="city_name" placeholder="City *">
        <input type="text" id="state_name" placeholder="State *">
        <input type="text" id="pincode" placeholder="Pincode *">
        <button class="green" onclick="saveAddress()">Save Address</button>
    </div>
    <button class="gray" onclick="back()">‚Üê Back to Saved Addresses</button>
</div>


<div id="aboutUs" class="page">
    <div class="card">
        <h3>About RentelBike</h3>
        <p>RentelBike is dedicated to providing affordable, reliable, and easy bike rentals across India. We connect bike owners with renters seamlessly.</p>
    </div>
    <div class="card">
        <h4>Meet the Founders</h4>
        
        <div class="owner-card">
            <img src="shivam.jpg" alt="Shivam Pal, Founder & Operation Head">
            <div><strong>Shivam Pal</strong><br><small>Founder & Operation Head</small></div>
        </div>
        <div class="owner-card">
            <img src="rishikesh.jpg" alt="Rishikesh Yadav, CEO & Market Head">
            <div><strong>Rishikesh Yadav</strong><br><small>CEO & Market Head</small></div>
        </div>
        <div class="owner-card">
            <img src="utkarsh.jpg" alt="Utkarsh Pandey, Co-founder-Director">
            <div><strong>Utkarsh Pandey</strong><br><small>Co-founder-Director</small></div>
        </div>
    </div>
    <button class="gray" onclick="back()">‚Üê Back to Profile</button>
</div>

<div id="transactionHistory" class="page">
    <div class="card">
        <h3>Transaction History</h3>
        <p>Displaying last 3 transactions:</p>
        <div style="border-bottom: 1px dashed #ccc; padding: 10px 0;">
            <strong>Paid: Hero Splendor Rental</strong><br>
            <small>Amount: ‚Çπ900 | Date: 12/03/2025</small>
        </div>
        <div style="border-bottom: 1px dashed #ccc; padding: 10px 0;">
            <strong>Received: Royal Enfield Rental</strong><br>
            <small>Amount: ‚Çπ2,100 | Date: 05/03/2025</small>
        </div>
        <div style="padding: 10px 0;">
            <strong>Paid: Service Fee</strong><br>
            <small>Amount: ‚Çπ50 | Date: 01/03/2025</small>
        </div>
    </div>
    <button class="gray" onclick="back()">‚Üê Back to Profile</button>
</div>

<div id="walletEarnings" class="page">
    <div class="card text-center">
        <h3>Wallet & Earnings</h3>
        <p>Current Balance:</p>
        <h1 style="color:#22c55e;">‚Çπ 5,450.00</h1>
        <button class="green" onclick="simulateWalletAction('Withdraw')">Withdraw Funds</button>
        <button class="blue" onclick="simulateWalletAction('Add Money')">Add Money</button>
    </div>
    <div class="card">
      <h4>Recent Activity (Simulated)</h4>
      <p>+ ‚Çπ2100 (Bike Rent)</p>
      <p>- ‚Çπ900 (Booking Paid)</p>
    </div>
    <button class="gray" onclick="back()">‚Üê Back to Profile</button>
</div>


<div id="listBikeForm" class="page">
  <div class="card">
    <h3>List Bike: Owner Information (Admin Use Only)</h3>
    <label for="owner_full_name">Owner's Full Name * (This Name will be visible to renters)</label>
    <input type="text" id="owner_full_name" placeholder="Full Name">

    <label for="owner_exact_location">Owner's Exact Location (House No., Street, Pincode) * (Admin will see this)</label>
    <textarea id="owner_exact_location" placeholder="House No., Street/Gali No., Pincode"></textarea>

    <label for="owner_live_photo">Owner Live Photo (Selfie holding ID) * (Admin will see this)</label>
    <input type="file" id="owner_live_photo" accept="image/*" capture="camera">
  </div>

  <div class="card">
    <h3>List Bike: Bike Information</h3>
    <label for="bike_state_list">Bike Location (State) *</label>
    <select id="bike_state_list"><option value="Delhi" selected>Delhi</option></select>
    <label for="bike_city_list">Bike Location (City) *</label>
    <select id="bike_city_list"><option value="New Delhi" selected>New Delhi</option></select>
    <input type="text" id="bike_make" placeholder="Bike Make (e.g., Hero, Royal Enfield) *">
    <input type="text" id="bike_model_list" placeholder="Bike Model (e.g., Splendor, Classic 350) *">
    <input type="number" id="bike_engine_cc" placeholder="Bike Engine CC (e.g., 350) *">
    <label for="bike_fuel_type">Fuel Type *</label>
    <select id="bike_fuel_type"><option value="Petrol" selected>Petrol</option></select>
    <input type="number" id="bike_mileage" placeholder="Mileage (kmpl) *">
    <input type="number" id="bike_rate_day" placeholder="Rate Per Day (‚Çπ) *">
    <label for="bike_reg_year">Year of Registration *</label>
    <input type="number" id="bike_reg_year" placeholder="Year (e.g., 2020)" min="1990" max="2025" value="2020">
    <input type="text" id="bike_insurance_provider" placeholder="Insurance Provider Name *">
    <label for="bike_expiry">Insurance Expiry Date *</label>
    <input type="date" id="bike_expiry" value="2026-01-25">
    
    <button class="green" onclick="showPage('bikeUpload')">Next: Upload Documents</button>
    <button class="gray" onclick="back()">‚Üê Back</button>
  </div>
</div>
<div id="bikeUpload" class="page">
  <div class="card">
    <h3>Bike Documents & Photos (Camera Mandatory)</h3>
    <p>Bike Front Photo *</p><input type="file" id="bike_front" accept="image/*" capture="camera">
    <p>Bike Back Photo *</p><input type="file" id="bike_back" accept="image/*" capture="camera">
    <p>Bike Left Side Photo *</p><input type="file" id="bike_left" accept="image/*" capture="camera">
    <p>Bike Right Side Photo *</p><input type="file" id="bike_right" accept="image/*" capture="camera">
    <p>Bike RC Book Photo *</p><input type="file" id="bike_rc_book" accept="image/*" capture="camera">
    <button class="green" onclick="submitBikeForApproval()">Submit Bike for Approval</button>
    <button class="gray" onclick="back()">‚Üê Back</button>
  </div>
</div>
<div id="kycUpload" class="page">
  <div class="card">
    <h3>Upload KYC Documents</h3>
    <p>Adhar Card Front Photo *</p><input type="file" id="adhar_front" accept="image/*" capture="camera">
    <p>Adhar Card Back Photo *</p><input type="file" id="adhar_back" accept="image/*" capture="camera">
    <p>Driving License Front Photo *</p><input type="file" id="dl_front" accept="image/*" capture="camera">
    <p>Driving License Back Photo *</p><input type="file" id="dl_back" accept="image/*" capture="camera">
    <button class="green" onclick="submitKYC()">Submit KYC for Approval</button>
    <button class="gray" onclick="back()">‚Üê Back</button>
  </div>
</div>

<div id="admin" class="page">
  <div class="card">
    <h3>Admin Bike Panel: Pending Approvals</h3>
    <div id="adminBikeList">
      <div class="profile-item-btn" onclick="viewAdminBikeDetail('Bike123', 'Hero Splendor', 'New Delhi')">
        Hero Splendor (New Delhi) <small style="color:red; float:right;">PENDING</small>
      </div>
      <div class="profile-item-btn" onclick="viewAdminBikeDetail('Bike456', 'Royal Enfield Classic 350', 'Lucknow')">
        Royal Enfield Classic 350 (Lucknow) <small style="color:red; float:right;">PENDING</small>
      </div>
    </div>
  </div>
  <button class="gray" onclick="back()">‚Üê Back</button>
</div>
<div id="adminReview" class="page">
  <div class="card" id="adminReviewCard"><h3>Bike Review</h3><p>Loading...</p></div>
  <button class="gray" onclick="back()">‚Üê Back</button>
</div>
<div id="adminKYC" class="page">
  <div class="card">
    <h3>Admin KYC Panel: Pending Approvals</h3>
    <div id="adminKYCList">
      <div class="profile-item-btn" onclick="viewAdminKYCDetail('KYC789', 'Renter User 1', '9876543210')">
        Renter User 1 (9876543210) <small style="color:red; float:right;">PENDING</small>
      </div>
    </div>
  </div>
  <button class="gray" onclick="back()">‚Üê Back</button>
</div>
<div id="adminKYCReview" class="page">
  <div class="card" id="adminKYCReviewCard"><h3>KYC Review</h3><p>Loading...</p></div>
  <button class="gray" onclick="back()">‚Üê Back</button>
</div>


<nav id="appNav">
  <button onclick="showPage('home')">Home</button>
  <button onclick="showPage('explore')">Explore</button>
  <button onclick="showPage('profile')">Profile</button>
</nav>

<script>
// --- Global State Simulation ---
let currentUser = null;
let currentPage = 'login';
let history = [];
let currentBike = {};
let previousPageAfterPayment = ''; 
const ADMIN_PHONE = '9336231919';
const ADMIN_PASS = 'RB@Admin2025';
const SIMULATED_OTP = '123456';
const USERS = [
  { phone: ADMIN_PHONE, pass: ADMIN_PASS, name: 'RentelBike Admin', email: 'N/A', dob: 'N/A', kyc: 'APPROVED' },
  { phone: '9876543210', pass: 'user123', name: 'Renter User 1', email: 'user@example.com', dob: '1990-01-01', kyc: 'PENDING' }
];

// --- Core Navigation ---
function showPage(pageId) {
    if (currentPage !== pageId) {
        if (pageId !== 'payment' && currentPage !== 'bikeDetail' && currentPage !== 'payment') {
             history.push(currentPage);
        } else if (pageId === 'payment') {
            previousPageAfterPayment = currentPage;
        } else if (['explore', 'profile', 'home', 'contactSupportPage', 'savedAddressesPage', 'invoicesAndBills', 'myListedBikesPage'].includes(pageId)) { 
            // When navigating to main pages or new profile subpages, clear intermediate pages to prevent deep back loop
            history = history.filter(p => p !== 'bikeDetail' && p !== 'payment' && p !== 'addAddressForm'); 
        }
    }
    
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    const newPage = document.getElementById(pageId);
    if (newPage) {
        newPage.classList.add('active');
        currentPage = pageId;
    }
    
    const header = document.getElementById('appHeader');
    const nav = document.getElementById('appNav');
    const body = document.body;

    if (pageId === 'login' || pageId === 'signupForm' || pageId === 'forgotPass' || pageId === 'verifyResetOTP') {
        body.classList.add('auth-page');
        header.style.display = 'none'; 
        nav.style.display = 'none';
    } else {
        body.classList.remove('auth-page');
        header.style.display = 'block'; 
        nav.style.display = 'flex';
        updateProfileDisplay(); 
    }
}

function back() {
    // FIX: Handle back from Payment page to Bike Details page
    if (currentPage === 'payment' && previousPageAfterPayment === 'bikeDetail') {
        previousPageAfterPayment = ''; 
        showPage('bikeDetail'); 
        return;
    }

    // FIX: If coming from BikeDetail, clear history to prevent loop when going back to Explore
    if (currentPage === 'bikeDetail' && history[history.length - 1] === 'explore') {
        history.pop();
        showPage('explore');
        return;
    }
    
    if (history.length > 0) {
        const prevPage = history.pop();
        showPage(prevPage);
    } else {
        if (currentUser) {
            showPage('home');
        } else {
            showPage('login');
        }
    }
}

function loadAll() {
    showPage('login'); 
    document.getElementById('bike_expiry').value = '2026-01-25'; 
    document.getElementById('bike_reg_year').value = new Date().getFullYear() - 5;
}

// NEW: Download PDF function
function downloadPDF(invoiceId) {
    alert(`Invoice/Bill ${invoiceId} is now downloading as PDF... (Simulated)`);
}

// NEW: Support functions
function submitSupportMessage() {
    alert('Thank you! Your message has been submitted. Our team will contact you shortly.');
    showPage('contactSupportPage'); // Stay on page or navigate back
}

// NEW: Address functions
function deleteAddress(buttonElement) {
    if (confirm("Are you sure you want to delete this address?")) {
        // Find the parent div with class 'address-item' and remove it
        const addressItem = buttonElement.closest('.address-item');
        if (addressItem) {
            addressItem.remove();
            alert('Address deleted successfully.');
        } else {
            alert('Error: Could not find address item to delete.');
        }
    }
}

function saveAddress() {
    const type = document.getElementById('address_type').value;
    const address = document.getElementById('full_address').value;
    const city = document.getElementById('city_name').value;
    const state = document.getElementById('state_name').value;
    const pincode = document.getElementById('pincode').value;

    if (!address || !city || !state || !pincode) {
        alert('Please fill in all mandatory address fields.');
        return;
    }

    // Simulate adding the new address
    const addressList = document.getElementById('addressList');
    const newAddressDiv = document.createElement('div');
    newAddressDiv.className = 'address-item';
    newAddressDiv.innerHTML = `
        <div>
            <strong>${type}:</strong> ${address}, ${city}, ${state}, ${pincode} 
        </div>
        <button class="red" onclick="deleteAddress(this)">Delete</button>
    `;

    addressList.appendChild(newAddressDiv);
    alert('New address saved successfully!');
    // Clear form fields after successful save (optional but good UX)
    document.getElementById('full_address').value = '';
    document.getElementById('city_name').value = '';
    document.getElementById('state_name').value = '';
    document.getElementById('pincode').value = '';
    
    showPage('savedAddressesPage');
}


// NEW: Wallet Actions (Same as before)
function simulateWalletAction(action) {
    if (!currentUser || currentUser.phone === 'Guest') {
        alert('Please Login/Signup to access Wallet features!');
        showPage('login');
        return;
    }
    
    if (action === 'Withdraw') {
        alert('Withdrawal initiated! Funds will be credited to your linked bank account (Simulated).');
    } else if (action === 'Add Money') {
        alert('Redirecting to Payment Gateway to Add Money (Simulated).');
    }
}

// --- Auth Functions (Same as before) ---
function login() {
    const mobile = document.getElementById('mobileInput').value;
    const password = document.getElementById('passwordInput').value;
    
    const user = USERS.find(u => u.phone === mobile && u.pass === password);

    if (user) {
        currentUser = user;
        alert(`Login Successful! Welcome, ${currentUser.name}.`);
        showPage('home');
    } else {
        alert('Invalid Mobile or Password!');
    }
}
function loginAsGuest() {
    currentUser = { phone: 'Guest', pass: '', name: 'Guest User', email: 'N/A', dob: 'N/A', kyc: 'PENDING' };
    alert('Logged in as Guest. Please sign up to use all features.');
    showPage('explore');
}

// UPDATED: Signup function with DOB and Age Validation (Logic is unchanged, only UI was fixed)
function signup() {
    const name = document.getElementById('signup_name').value;
    const mobile = document.getElementById('signup_mobile').value;
    const password = document.getElementById('signup_password').value;
    const dob = document.getElementById('signup_dob').value; 

    if (!name || !mobile || !password || !dob) {
        alert('Please fill in all required fields (Name, Mobile, Password, and Date of Birth).');
        return;
    }
    
    // --- Age Validation Logic ---
    const birthDate = new Date(dob);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    
    // Adjust age if birthday hasn't occurred yet this year
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }

    if (age < 18) {
        alert('You must be at least 18 years old to sign up for RentelBike.');
        return;
    }
    // --- End Age Validation Logic ---
    
    if (USERS.some(u => u.phone === mobile)) {
        alert('This mobile number is already registered.');
        return;
    }

    const newUser = {
        phone: mobile,
        pass: password,
        name: name,
        email: document.getElementById('signup_email').value || 'N/A',
        dob: dob, 
        kyc: 'PENDING'
    };
    USERS.push(newUser);
    currentUser = newUser;
    alert('Signup Successful! You are now logged in.');
    showPage('home');
}
function sendOTP() {
    const mobile = document.getElementById('forgot_mobile').value;
    if (USERS.some(u => u.phone === mobile)) {
        alert(`Simulated OTP (123456) sent to ${mobile}.`);
        showPage('verifyResetOTP');
    } else {
        alert('Mobile number not registered.');
    }
}
function resetPassword() {
    const otp = document.getElementById('otp_input').value;
    const newPass = document.getElementById('reset_newPass').value;
    const mobile = document.getElementById('forgot_mobile').value;

    if (otp !== SIMULATED_OTP) {
        alert('Invalid OTP. The simulated OTP is 123456.');
        return;
    }
    if (newPass.length < 4) {
        alert('New password must be at least 4 characters long.');
        return;
    }

    const userIndex = USERS.findIndex(u => u.phone === mobile);
    if (userIndex !== -1) {
        USERS[userIndex].pass = newPass;
        alert('Password Reset Successful! Please login with your new password.');
        showPage('login');
    } else {
        alert('Error: User not found.');
    }
}
function logout() {
    currentUser = null;
    history = [];
    alert('You have been logged out.');
    showPage('login');
}


// --- Bike/Booking Functions (Same as before) ---
function searchBikes() {
    alert('Searching for bikes... (Simulated result shown below)');
}

function showBikeDetail(model, rate, imageContext) {
    currentBike.model = model;
    currentBike.rate = rate;
    
    document.getElementById('bike_model').textContent = model;
    document.getElementById('bike_rate').textContent = `‚Çπ${rate}/day`;
    document.getElementById('rent_days').value = 1;
    calculateTotal();

    const imagesContainer = document.getElementById('bike_images');
    imagesContainer.innerHTML = '';
    
    if (model.includes('Classic')) {
      imagesContainer.innerHTML = `
        <img src="https://i.ibb.co/3sX0jB8/1000055679.jpg" alt="Bike Image">
        <img src="https://i.ibb.co/L5k1g0F/1000055678.jpg" alt="Bike Image">
      `;
    } else {
      imagesContainer.innerHTML = `
        <img src="https://i.ibb.co/L5k1g0F/1000055678.jpg" alt="Bike Image">
      `;
    }
    
    showPage('bikeDetail');
}

function calculateTotal() {
    const rate = currentBike.rate || 0;
    const days = parseInt(document.getElementById('rent_days').value) || 1;
    const total = rate * days;
    document.getElementById('bike_total_amount').textContent = `‚Çπ${total}`;
    
    document.getElementById('payment_bike_model').textContent = currentBike.model || 'Bike';
    document.getElementById('payment_rent_days').textContent = days;
    document.getElementById('payment_total_amount').textContent = total;
}

function bookBike() {
    if (!currentUser || currentUser.phone === 'Guest') {
        alert('Please Login/Signup to Book a Bike!');
        showPage('login');
        return;
    }
    
    if (currentUser.kyc !== 'APPROVED') {
        alert('Your KYC must be APPROVED to book a bike. Please complete KYC from the Profile page.');
        showPage('profile');
        return;
    }
    
    showPage('payment');
}

function confirmPayment() {
    const paymentMethod = document.getElementById('payment_method').value;
    const totalAmount = document.getElementById('payment_total_amount').textContent;
    alert(`Payment of ‚Çπ${totalAmount} confirmed via ${paymentMethod} (Simulated). Your booking is confirmed!`);
    
    history = history.filter(p => p !== 'bikeDetail' && p !== 'payment'); 
    showPage('explore');
}

// --- Submit Bike for Approval (Same as before) ---
function submitBikeForApproval() {
    const ownerFields = ['owner_full_name', 'owner_exact_location'];
    const bikeFields = [
        'bike_make', 'bike_model_list', 'bike_engine_cc', 'bike_fuel_type',
        'bike_mileage', 'bike_rate_day', 'bike_reg_year', 
        'bike_insurance_provider', 'bike_expiry'
    ];
    
    const allFields = [...ownerFields, ...bikeFields];

    for (const fieldId of allFields) {
        const value = document.getElementById(fieldId).value;
        if (!value) {
            alert(`Please fill in the mandatory field: ${fieldId.replace(/_/g, ' ')}`);
            showPage('listBikeForm');
            return;
        }
    }

    const requiredFiles = [
        'bike_front', 'bike_back', 'bike_left', 'bike_right',
        'owner_live_photo', 'bike_rc_book'
    ];
    for (const fileId of requiredFiles) {
        if (document.getElementById(fileId).files.length === 0) {
            alert(`Please upload the mandatory photo/document: ${fileId.replace(/_/g, ' ')}`);
            showPage('bikeUpload');
            return;
        }
    }
    
    alert('Bike submitted for Admin Approval (Simulated). Owner details (Exact Location, Live Photo, and Phone No.) are securely stored and visible only to the Admin for verification.');
    showPage('home');
}

function submitKYC() {
    const requiredFiles = ['adhar_front', 'adhar_back', 'dl_front', 'dl_back'];
    for (const id of requiredFiles) {
        if (document.getElementById(id).files.length === 0) {
            alert(`Please upload the file for: ${id.replace(/_/g, ' ')}`);
            return;
        }
    }
    alert('KYC documents submitted for Admin Approval (Simulated).');
    currentUser.kyc = 'PENDING_REVIEW';
    updateProfileDisplay();
    showPage('profile');
}


// --- Profile & KYC Display (Same as before) ---
function updateProfileDisplay() {
    if (currentUser) {
        document.getElementById('profile_name').textContent = currentUser.name;
        document.getElementById('profile_mobile').textContent = currentUser.phone;
        document.getElementById('profile_email').textContent = currentUser.email;
        document.getElementById('profile_dob').textContent = currentUser.dob;

        const kycStatusElement = document.getElementById('kyc_status');
        const kycButton = document.getElementById('kyc_button');
        
        kycStatusElement.textContent = currentUser.kyc;
        
        if (currentUser.kyc === 'APPROVED') {
            kycStatusElement.style.color = 'green';
            kycButton.textContent = 'KYC Approved';
            kycButton.className = 'blue';
            kycButton.onclick = null;
        } else if (currentUser.kyc === 'PENDING_REVIEW') {
            kycStatusElement.style.color = 'orange';
            kycButton.textContent = 'Under Review';
            kycButton.className = 'orange';
            kycButton.onclick = null;
        } else {
            kycStatusElement.style.color = 'red';
            kycButton.textContent = 'Upload KYC Documents';
            kycButton.className = 'orange';
            kycButton.onclick = function() { showPage('kycUpload'); };
        }
    }
}


// --- Admin Functions (Same as before) ---
function adminLogin(panelType) {
    if (!currentUser || currentUser.phone !== ADMIN_PHONE) {
        alert('Only the Admin can access this panel.');
        return;
    }

    const phonePrompt = prompt(`Admin Login: Enter Phone Number (Admin: ${ADMIN_PHONE}):`);
    if (phonePrompt !== ADMIN_PHONE) {
        alert('Invalid Admin Phone Number.');
        return;
    }

    const passPrompt = prompt(`Admin Login: Enter Password (Pass: ${ADMIN_PASS}):`);
    if (passPrompt !== ADMIN_PASS) {
        alert('Invalid Admin Password.');
        return;
    }

    alert('Login Successful! Welcome, RentelBike Admin.');
    if (panelType === 'admin') {
        showPage('admin');
    } else if (panelType === 'kyc') {
        showPage('adminKYC');
    }
}

function viewAdminBikeDetail(bikeId, model, location) {
    const reviewCard = document.getElementById('adminReviewCard');
    const imagesHTML = `
        <p><strong>Bike Photos:</strong></p>
        <div class="admin-img-row">
            <img src="https://i.ibb.co/3sX0jB8/1000055679.jpg" alt="Front">
            <img src="https://i.ibb.co/3sX0jB8/1000055679.jpg" alt="Back">
            <img src="https://i.ibb.co/3sX0jB8/1000055679.jpg" alt="Left">
            <img src="https://i.ibb.co/3sX0jB8/1000055679.jpg" alt="RC">
        </div>
        <p><strong>Owner Photo:</strong></p>
        <div class="admin-img-row">
            <img src="https://i.ibb.co/y4L7q1L/owner-placeholder.jpg" alt="Owner Live Photo">
        </div>
    `;

    reviewCard.innerHTML = `
        <h3>Bike Review: ${bikeId}</h3>
        <p><strong>Model:</strong> ${model}</p>
        <p><strong>Location:</strong> ${location}</p>
        <p><strong>Rate/Day:</strong> ‚Çπ300 (Simulated)</p>
        <hr>
        <h4>Owner Verification (Admin Only)</h4>
        <p><strong>Owner Name:</strong> Admin User (Simulated)</p>
        <p><strong>Owner Phone:</strong> 9336231919</p>
        <p><strong>Exact Address:</strong> House No. 123, Saket, New Delhi (Simulated)</p>
        <hr>
        ${imagesHTML}
        <hr>
        <button class="green" onclick="approveBike('${bikeId}')">‚úÖ Approve Bike</button>
        <button class="red" onclick="rejectBike('${bikeId}')">‚ùå Reject Bike</button>
        <button class="gray" onclick="back()">‚Üê Back to List</button>
    `;
    showPage('adminReview');
}

function approveBike(bikeId) {
    alert(`Bike ${bikeId} Approved! (Simulated)`);
    back();
}

function rejectBike(bikeId) {
    alert(`Bike ${bikeId} Rejected! (Simulated)`);
    back();
}

function viewAdminKYCDetail(kycId, userName, mobile) {
    const reviewCard = document.getElementById('adminKYCReviewCard');
    const imagesHTML = `
        <p><strong>Adhar Card Photos:</strong></p>
        <div class="admin-img-row">
            <img src="https://i.ibb.co/Yc5qQGq/adhar-placeholder.jpg" alt="Adhar Front">
            <img src="https://i.ibb.co/Yc5qQGq/adhar-placeholder.jpg" alt="Adhar Back">
        </div>
        <p><strong>Driving License Photos:</strong></p>
        <div class="admin-img-row">
            <img src="https://i.ibb.co/F83Q8t7/dl-placeholder.jpg" alt="DL Front">
            <img src="https://i.ibb.co/F83Q8t7/dl-placeholder.jpg" alt="DL Back">
        </div>
    `;

    reviewCard.innerHTML = `
        <h3>KYC Review: ${kycId}</h3>
        <p><strong>User Name:</strong> ${userName}</p>
        <p><strong>Mobile:</strong> ${mobile}</p>
        <p><strong>KYC Status:</strong> PENDING</p>
        <hr>
        <p><strong>Uploaded DOB:</strong> 1990-01-01 (Simulated)</p>
        <hr>
        ${imagesHTML}
        <hr>
        <button class="green" onclick="approveKYC('${mobile}')">‚úÖ Approve KYC</button>
        <button class="red" onclick="rejectKYC('${mobile}')">‚ùå Reject KYC</button>
        <button class="gray" onclick="back()">‚Üê Back to List</button>
    `;
    showPage('adminKYCReview');
}

function approveKYC(mobile) {
    const user = USERS.find(u => u.phone === mobile);
    if (user) {
        user.kyc = 'APPROVED';
        if (currentUser && currentUser.phone === mobile) {
            currentUser.kyc = 'APPROVED';
        }
        alert(`KYC for ${mobile} Approved! (Simulated)`);
        back();
    }
}

function rejectKYC(mobile) {
    const user = USERS.find(u => u.phone === mobile);
    if (user) {
        user.kyc = 'REJECTED';
        if (currentUser && currentUser.phone === mobile) {
            currentUser.kyc = 'REJECTED';
        }
        alert(`KYC for ${mobile} Rejected! (Simulated)`);
        back();
    }
}
</script>

</body>
</html>
